---
topic: AWK 模式與動作
---
## 第4節：模式和動作

在 AWK 中，模式是用於選擇應該對哪些輸入行執行動作的條件。動作則是一系列在匹配模式的行上執行的命令，包括在滿足特定條件時處理和轉換數據的命令。這一節將介紹 AWK 中的模式匹配、基於模式的動作，以及正則表達式的應用。

### AWK 中的模式匹配

模式可以是任何產生布爾值（真或假）的表達式，例如比較運算符、正則表達式匹配等。AWK 程序中的模式和動作通常遵循以下格式：

```awk
pattern { action }
```

這表示當模式匹配時，將對該行執行動作。如果省略了模式，則對所有輸入行執行動作。如果省略了動作而模式匹配，則預設動作是打印該行。

#### 模式示例

- **正則表達式匹配：** `/pattern/` 形式的模式用於匹配包含特定文本的行。

```awk
/Apple/ { print $0 }
```

這條命令尋找包含 "Apple" 的所有行並打印它們。

- **字段值比較：** AWK 允許對特定字段進行條件比較。

```awk
$2 > 100 { print $1 }
```

這表示打印第二個字段值大於100的所有行的第一個字段。

### 基於模式的動作

在 AWK 中，動作是在匹配特定模式的行上執行的一系列命令，被大括號 `{}` 包裹。動作可以包括計算、打印（或不打印）行、格式化輸出等。

#### 動作示例

- **計算和匯總：** 使用 AWK 進行簡單的數據分析和匯總。

```awk
$2 > 100 { sum += $2; count++ }
END { print "Average:", sum/count }
```

這個 AWK 程序計算所有第二個字段值大於100的行的第二個字段的平均值。

### 正則表達式在 AWK 中的應用

正則表達式是模式匹配中一個強大的工具，允許對複雜的文本模式進行匹配。AWK 支持正則表達式作為匹配條件，提供靈活的文本處理能力。

#### 正則表達式示例

- **匹配開頭或結尾：** 使用錨點符號 `^` 和 `$` 匹配行的開頭或結尾。

```awk
/^#/ { print "This line starts with a hash (#)" }
```

這條命令尋找所有以井號 (#) 開頭的行。

- **範圍匹配：** 使用方括號 `[]` 匹配一個字符範圍。

	```awk
	$1 ~ /^[A-C]/ { print $1 }
	```
	
	這表示打印第一個字段以 A、B 或 C 開頭的行的第一個字段。
	
	在 AWK 中，`~` 運算符用於正則表達式匹配。當你看到 `$1 ~ /^[A-C]/` 這樣的表達式時，它的意思是“第一個字段 `$1` 是否匹配正則表達式 `/^[A-C]/`”。
	
	具體來說，這個表達式分解如下：
	
	- `$1` 指的是當前行的第一個字段。
	- `~` 是正則表達式匹配運算符，用於測試左側的字符串（在這個例子中是 `$1` 的值）是否匹配右側的正則表達式。
	- `/^[A-C]/` 是一個正則表達式，其中：
	  - `^` 表示行的開頭。
	  - `[A-C]` 表示匹配任何一個在 A 到 C 範圍內的字符。
	
	因此，當 AWK 處理一行時，如果該行的第一個字段以 A、B、或 C 開頭，`$1 ~ /^[A-C]/` 這個條件為真，隨後的 `{ print $1 }` 動作就會執行，打印出該行的第一個字段。
	
	同樣，AWK 也支持 `!~` 運算符，用於表示不匹配正則表達式的情況。如果你想選擇不以 A、B、或 C 開頭的行的第一個字段，可以使用 `$1 !~ /^[A-C]/` 這樣的表達式。

